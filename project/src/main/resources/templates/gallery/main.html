<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>갤러리</title>

    <link rel="stylesheet" href="/css/general.css">
    <link rel="stylesheet" href="/css/fragments/header.css">
    <link rel="stylesheet" href="/css/fragments/nav.css">
    <link rel="stylesheet" href="/css/fragments/footer2.css">
    <link rel="stylesheet" href="/css/gallery/main.css">

</head>

<body>
    <!-- 헤더 포함 -->
    <header th:replace="fragments/header.html :: header"></header>

    <div class="main-layout">
        <!-- 사이드바 포함 -->
        <nav th:replace="fragments/nav.html :: nav" style="width: 200px; margin-right: 20px;"></nav>

        <div class="photo-grid">
            <!-- galleryList를 반복문으로 처리 -->
            <div th:each="item : ${galleryList}" class="photo-item" onclick="open_modal(event)">
                <!-- <div th:each="item : ${galleryList}" class="photo-item"
                onclick="openModal('${item.galleryImg}', '${item.galleryTitle}', '${item.galleryHashtag}')"> -->
                <img th:src="@{${item.galleryImg}}" th:alt="${item.galleryTitle}" />
                <h3 class="modal-title" th:text="${item.galleryTitle}"></h3>

                <!-- <div class="hashtags-container" id="hashtagsContainer">

                </div> -->

                <p class="modal-hashtag" th:text="${item.galleryHashtag}"></p>

                <!-- <div class="actions">
                    <button type="button" class="like-btn" id="likeBtn">♥</button> -->
                    <!-- <button id="shareBtn">공유</button> -->
                <!-- </div> -->
                <!-- <button class="slider-btn next-btn" id="nextBtn">&#9654;</button> -->
            </div>
        </div>

        <!-- 모달 창 -->
        <div id="modal" class="modal" onclick="closeModal()" style="display:none;">
            <div class="modal-content" onclick="event.stopPropagation()">
                <img id="modal-image" src="" alt="Modal Image" />
                <p id="modal-title"></p>
                <div id="modal-hashtag" class="modal-hashtags-container"></div>
                <br>
                
                
                <!-- 하트 버튼 위치 조정 -->
                <form th:action="@{/like/gallery/{id}(id=${item.id})}" method="post">
                    <div class="actions">
                        <button type="button" class="like-btn" id="likeBtn" onclick="post_like()">♥</button>
                        <button type="button" onclick="closeModal()">닫기</button>
                    </div>
                </form>
            </div>
        </div>

        <a href="/gallery/upload" class="register-btn">갤러리 등록</a>
    </div>

    <!-- 푸터 포함 -->
    <footer th:replace="fragments/footer.html :: footer"></footer>


    <!-- 해시태그 처리 스크립트 -->


    <script>
        // 모달 열기
        function open_modal(event) {
            const modal = document.getElementById('modal');
            const modalImage = document.getElementById('modal-image');
            const modalTitle = document.getElementById('modal-title');
            const modalHashtag = document.getElementById('modal-hashtag');

            // 클릭한 요소에서 필요한 데이터 가져오기
            const photoItem = event.currentTarget;  // 클릭된 요소 (photo-item)
            const imageSrc = photoItem.querySelector('img').getAttribute('src');
            const title = photoItem.querySelector('.modal-title').innerText;
            // const hashtagString = photoItem.querySelector('.modal-hashtag').getAttribute('data-hashtag'); // data-hashtag 속성 값
            const hashtag = photoItem.querySelector('.modal-hashtag').innerText;

            // 해시태그 문자열을 '#'을 기준으로 split하여 배열로 만듭니다.
            const hashtags = hashtag.split('#').filter(tag => tag !== ""); // 공백이 포함된 항목 제거

            // 해시태그를 <span> 태그로 감싸서 표시
            modalHashtag.innerHTML = ''; // 이전에 표시된 해시태그들 초기화
            hashtags.forEach(tag => {
                const span = document.createElement('span');
                span.className = 'hashtag';  // 스타일을 위한 클래스 추가
                span.innerText = "#" + tag;
                modalHashtag.appendChild(span);
            });


            // 모달에 정보 넣기
            modalImage.src = imageSrc;
            modalTitle.innerText = title;
            // modalHashtag.innerText = hashtag;

            // 모달 보이게 하기
            modal.style.display = 'block';
        }


        function open_modal_leg(galleryImg, galleryTitle, galleryHashtag) {
            document.getElementById("modal").style.display = "block";
            document.getElementById("modal-image").src = galleryImg;
            document.getElementById("modal-title").src = galleryTitle;
            document.getElementById("modal-hashtag").innerText = galleryHashtag;
        }




        // 모달 창 닫기
        function closeModal() {
            document.getElementById("modal").style.display = "none";
        }

    </script>
</body>

</html>